---
title: API Моя МФО

language_tabs: # must be one of https://git.io/vQNgJ
  - HTTP
  
toc_footers:
  - ООО "Моя МФО". 
  - Все права защищены.
  - <a href='http://mfo1c.ru'>Перейти на сайт Моя МФО</a>


search: true
---

# Введение

Данная документация создана с целью описания механизмов взаимодействия системы "Моя МФО" и сайта компании, которая является пользователем данного программного продукта.
Данный API (программный интерфейс) позволяет реализовать различные схемы взаимодействия: загрузку заявок, выдачу займов и прием платежей.
Чтобы начать использовать эти возможности нужно начать с публикации веб-сервисов.
Далее вы найдете описание самих веб-сервисов с примерами.

<aside class="notice">
Настройка веб-сервера и подключение http-сервисов, требуют определенного опыта, и не являются самыми простыми механизмами, поэтому при необходимости возможна помощь специалиста 1С.
</aside>

# Публикация веб-сервисов

## При работе на собственном сервере
На сервере, где требуется произвести публикацию веб-сервисов необходимо произвести установку веб сервера (MS IIS или Apache), после этого, к нему устанавливается плагин от 1С, который передает запросы пользователей на сервер 1С.

Таким образом, операции физически выполняет сервер 1С, а веб-сервер (веб-сервис) служит просто передающим звеном.

<b>Производим установку веб сервера 1С.</b>

Установим веб сервер Microsoft Information Services (IIS)
Установку веб сервера можно произвести из Панели управления Windows (варианты):

- Установка и удаление программ/Компоненты Windows/IIS
- Program and features/Turn windows features on or off/Add features.

В Windows 8 перейдите на закладку Roles, выберите Add Roles (откроется мастер).

На соответствующих закладках мастера нужно выбрать:

- Web Server (IIS)
- Application Development/ISAPI Extensions.

`В других версиях Windows первая галочка может называться «Internet Information Services», вторая так же, или «Расширения ISAPI».`

<b>Установим компоненты 1С:Предприятие (после IIS)</b>

Нужно проверить, что при установки платформы были установлены следующие компоненты:

- Адаптер Web-сервисов 1С:Предприятие
    
<b>Проведем настройку IIS (после установки 1С)</b>

Настройку можно проводить в «Диспетчере служб IIS (IIS manager)», который находится в Панели управления Windows/Администрирование.

В ветке «Узлы (Web Sites)» находится веб-узел по-умолчанию, нажмите на него правой кнопкой и выберите «Добавить виртуальный каталог».
Выделим курсором созданный каталог (левой кнопкой мыши), справа отобразятся различные его настройки. Выберите «Сопоставление обработчиков (Handler mappings)».

Справа появятся доступные действия. Выберите «Добавить сопоставление сценария (Add script map)».

Введите путь запроса «*», выберите исполняемый файл «wsisapi.dll» в каталоге bin соответствующей версии 1С:Предприятие, установленной на этом сервере (не забываем про права, если они у Вас специально ограничены).

По кнопке «Ограничение запроса (Request Restrictions)» там же, необходимо установить разрешающую галочку. После создания этого обработчика, установите на него курсор мыши, выберите «Проверка подлинности (Edit handler permissions)», разрешите его выполнение (Execute). Если база файловая, необходимо дать доступ к папке базы.

Далее правой кнопкой на созданный каталог, пункт «Преобразовать в приложение (Convert to Application)».

<b>Публикация веб-сервисов конкретной базы</b>

Зайдите в конфигуратор требуемой базы данных на этом сервере (компьютере).

В меню Администрирование/Публикация на веб-сервере выберите:

- имя базы
- каталог (обычно это «C:\Intetpub\wwwroot\КаталогОпубликованногоHTTPСервиса\») 

`КаталогОпубликованногоHTTPСервиса - можно назвать именем базы`

- на вкладке http-сервисы проставьте все галки

Нажмите кнопку «Опубликовать».

В результате в требуемом каталоге должен появится файл с расширением VRD.

`Проверяем брандмауэр (фаервол), антивирус и фильтры трафика на блокировку доступа к веб-сервису`

## При работе через "Сервис Клауд"

В случае, если вы работаете на сервере компании "Сервис Клауд", нужно произвести ряд действий:

1. Добавить в информационную базу пользователя с таким же логином и паролем, как у одного из учетных записей для подключения к серверу "Сервис Клауд".
Именно под этим пользователем будет происходить авторизация и выполнение веб-сервисов.

2. Написать в службу технической поддержки запрос о публикации всех веб-сервисов вашей рабочей информационной базы. Путь к базе или название нужно указать, чтобы они поняли о какой базе идет речь.

3. В случае, если специалисты тех.поддержки опубликуют веб-сервисы, уточнить у них пути к веб-сервисам, если они не предоставят их в письме-уведомлении.

# Концепция работы личного кабинета

Личный кабинет заемщика на сайте компании - это раздел на сайте МФО, доступ к которому имеют только авторизованные пользователи, и который позволяет, в зависимости от установленных в компании правил производить:

- оформление заявки на займ
- подпись документов
- контроль текущей задолженности по займам
- просмотр истории заявок и займов
- внесение оплаты за займы
и т.д.

Для осуществления выше описанных функций требуется информация, которая содержится в системе "Моя МФО".
Чтобы получить эту информацию необходимо выполять конкретные http-запросы к опубликованной базе "Моя МФО".

Запросы выполняются последовательно. Ниже приведен один из вариантов реализации такого взаимодействия:

1. Отправляется заявка на займ. Выполняется http-метод Request.
2. После отправки заявки, заемщик может перейти в раздел "Личный кабинет" на сайте ввести свой номер телефона/паспорта или другой идентификатор. 
После ввода ему в СМС или на e-mail должен прийти пароль для входа. Для получения пароля и входа в личный кабинет используется http-метод client.
3. Сразу после авторизации выполняется http-метод NumbersDeals, который получает все номера заявок и договоров текущего клиента.
4. Далее может быть выполнен http-метод StatusDeal, который получает статусы заявок.
5. Далее, если клиент входит в конкретную заявку/договор, может быть вызван http-метод PS, который отображает подробную информацию о текущей задолженности.
6. Если клиент подал заявку и она одобрена, он может ознакомиться с договором, который может быть получен http-методом dealinpdf.
7. На этом этапе или раньше клиент должен привязать банковскую карту. Привязанная карта передается в базу "Моя МФО" при помощи http-метода card/attachtoclient или card/attachtodeal.
8. Если клиент готов подписать договор вызывается http-метод dealsign/code, который отправляет сайту одноразовый код для подписания договора.
Данный код, должен быть указан клиентом как аналог собственоручной подписи.
9. Если клиент указал код, он должен быть отправлен сайтом на проверку в базу "Моя МФО" посредством http-метода dealsign/codereview. Если код указан верно возвращается подписанный договор.
10. Далее из системы "Моя МФО" происходит выдача займа. В случае, если выдача происходит за пределами системы "Моя МФО" зарегистрировать факт выдачи займа можно при помощи метода fixingissue.
11. Внесение оплаты по займу может быть произведено разными способами. Для сервисов, с которыми реализована прямая интеграция нет необходимости дополнительных настроек на стороне сайта, это такие сервисы как:

- Золотая корона
- Киви
- Элекснет
- МКБ
- Mandarinpay

В случае, если на сайте имеется какой-то уникальный метод внесения платежей, он может быть интегрирован с системой "Моя МФО" в формате, когда информацию о платеже передает сам сайт.
В этом случае используется метод <a name="payment_site">Payment/Site</a>.

<aside class="notice">
В случае дополнительных вопросов вы всегда можете обратиться в службу технической поддержки по адресу: support@mfo1c.ru.
</aside> 
 
# Вход в личный кабинет

## Авторизация клиента в ЛК

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/client/?phone=89111111111&pass=Hgu32D11`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате xml:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<response>
	<status>0</status>
	<errormessage></errormessage>
	<IDClient>0000001232</IDClient>
	<fio>Иванов Иван Иванович</fio>
	<datebirthday>22.11.1988</datebirthday>
	<series>0101</series>
	<number>111222</number>
	<issued>МО УФМС России</issued>
	<dateissue>29.07.2008</dateissuecode>
	<code>270-000</code>
	<residence>190000, Санкт-Петербург, пр. Обуховской обороны д.86 кв.17</residence>
	<registration>190000, Санкт-Петербург, пр. Елизарова д.12 кв.271</registration>
	<placeofwork>ООО "Перспектива"</placeofwork>
	<email>test@mail.ru</email>
	<blacklist>false</blacklist>
	<dateofban>11.01.2019</dateofban>
</response>
``` 

Данный запрос позволяет получить данные по клиенту из базы "Моя МФО" по номеру телефона и хэш-паролю (параметр Pass).

<aside class="notice">
Если хэш-пароль не задан, система его создает. В этом случае в запросе он не передается.
</aside>

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/client/?phone=<phone>&pass=<pass>`

### Параметры запроса

Параметр | Описание
--------- | -----------
phone | Телефон клиента
pass | Хэш-пароль, формируется как sha256 от phone + Пароль клиента в базе. Если не передается система формирует его и возвращает в ответе.

### Возвращаемые значения

Параметр | Описание
--------- | -----------
status | Статус: 0 - успешно; 2 - не успешно, не совпадает пароль; 11 - успешно, создан пароль; 1 - не найден контрагент или не задан СМС-шаблон
errormessage | Описание ошибки
IDClient | Идентификатор клиента
fio | ФИО клиента
datebirthday | Дата рождения
series | Серия паспорта
issued | Орган выдачи паспорта
dateissue | Дата выдачи паспорта
code | Код подразделения
residence | Адрес по месту проживания
registration | Адрес по месту регистрации
placeofwork | Место работы
email | Адрес эл. почты
blacklist | Клиент в черном списке (true/false)
dateofban | Дата запрета на подачу заявок

## Получение всех номеров договоров (сделок) по одному клиенту

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/NumbersDeals/0808761223`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"Договоры": 
	[
		{
			"НомерДоговора": "ТСК000153",
			"Оплачен": true
		},
		{
			"НомерДоговора": "ТСК000145",
			"Оплачен": false
		},
		{
			"НомерДоговора": "ТСК000075",
			"Оплачен": false
		},
		{
			"НомерДоговора": "ТСК000030",
			"Оплачен": false
		},
		{
			"НомерДоговора": "ТСК000161",
			"Оплачен": false
		},
	],
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет получить информацию о всех номерах договоров (сделок).

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/NumbersDeals/<Паспорт>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
Паспорт | Серия и номер паспорта без пробелов

### Возвращаемые значения

Параметр | Описание
--------- | -----------
НомерДоговора | Номер договора займа
Оплачен | Статус оплаты займа: true или false
СообщениеОбОшибке | Описание ошибки, если она возникает

# Выдача займов

## Отправка заявки

```HTTP
POST http://АдресСервера/КаталогОпубликованногоHTTPСервиса/hs/Request/
User-Agent: АдресСервера
Content-Type: application/json
```

```json
{
  "ID" : ""
  "last_name" : "Тестов",
  "first_name" : "Тест",
  "middle_name" : "Тестович",
  "phone" : "89117115544", 
  "birthday" : "2017-05-05",
  "email" : "test88@mail.ru", 
  "amount" : "15000",
  "period" : "2017-06-20",
  "inn_number" : "4445558877", 
  "id_sex" : "Мужской", 
  "passport_series" : "45 10", 
  "passport_number" : "666666", 
  "passport_date_of_issue" : "2008-01-09",
  "birthplace" : "г. Хабаровск",
  "passport_org" : "ОВД Центрального округа, гор. Хабаровска",
  "passport_code" : "270-009",
  "incoming" : "35000",
  "work_name" : "ОАО РЖД",
  "experience" : "60",
  "work_phone" : "88123839935",
  "residential_region" : "Забайкальский кр.",
  "residential_city" : "г. Самара",
  "residential_street" : "Афонина",
  "residential_house" : "12",
  "residential_building" : "2",
  "residential_apartment" : "62",
  "match_addresses" : "0"
  "registrarion_region" : "Санкт-Петербург",
  "registrarion_city" : "Зеленогорск",
  "registrarion_street" : "Порядковая",
  "registrarion_house" : "11",
  "registrarion_building" : "3",
  "registrarion_apartment" : "58",
  "files": [
			{"filename":"Паспорт_страница_1", "bitmap":"0KLQtdGB0YIx"},
			{"filename":"Паспорт_страница_2", "bitmap":"0KLQtdGB0YIy"}
		   ]
		   
  //для передачи информации об автозалоге...
  "car_model" : "Тойота Камри",  		
  "car_issuedate" : "2006",
  "car_price" : "600000",
  "car_color" : "Белый"
  "car_number" : "С238ОГ",
  "car_vin" : "GDRT2890JH23GFDV22",
  "sts_number" : "К34821",
  "sts_issueby" : "Центральной МВД",
  "pts_number" : "34 4321м",
  "pts_issueby" : "Центральной МВД"
}
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"result": "1",
	"description": "Заявка создана",
	"IDDeal": "ТСК000157",
	"IDClient": "000019183"
}
```

> В случае ошибки запрос вернет:

```json
{
	"result": "0",
	"description": "Описание ошибки",
}
```

Данный запрос позволяет загружать заявки с сайта компании или других ресурсов (лидогенераторов) в базу "Моя МФО"

### HTTP-запрос

`POST http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/Request/`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом

### Описание обязательных полей анкеты

Параметр | Описание
--------- | -----------
amount | Сумма займа
period | Дата возврата
interval | Количество платежей (для займов с периодическим платежами)
creditproduct | Кредитный продукт
last_name | Фамилия
first_name | Имя
middle_name | Отчество
phone | Телефон
birthday | Дата рождения
passport_series | Серия паспорта
passport_number | Номер паспорта

<aside class="success">
В системе предоставляется загрузка любых доступных полей и назначение им соответствующих тегов при передаче.
Данный функционал настраивается в системе "Моя МФО" в разделе <b>Настройки "Моя МФО"\Общие\Обмен с сайтом\Онлайн-заявки</b>
</aside>

### Возвращаемые значения

Параметр | Описание
--------- | -----------
result | Результат, 1 - загружено успешно; 0 - не загружено
description | Описание
IDDeal | Номер заявки (договора)
IDClient | Код заемщика

## Проверка статуса договора (сделки)

```HTTP
POST http://192.168.0.1/MeMFOWork/hs/statusdeal`
User-Agent: АдресСервера
Content-Type: application/json
```

```json
{
  "IDDeal1" : "1_000000001"
  "IDDeal2" : "1_000000012"
  "IDDeal3" : "1_000000003"
  "IDDeal4" : "1_000000010"
} 
 ```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"ID1": {
		"НомерСделки": "1_000000001",
		"ДатаСделки": "2017-09-21T10:15:30",
		"Статус": "Выдан"
			},
	"ID2": {
		"НомерСделки": "1_000000012",
		"ДатаСделки": "2017-09-12T10:15:30",
		"Статус": "На рассмотрении"
			},
	"ID3": {
		"НомерСделки": "1_000000003",
		"ДатаСделки": "2017-09-23T10:15:30",
		"Статус": "Оплачен"
			},
	"ID3": {
		"НомерСделки": "1_000000010",
		"ДатаСделки": "2017-09-20T10:15:30",
		"Статус": "Предварительно одобрено"
			},
	
	"КодОтвета": 0
}
```

Данный запрос позволяет получить информацию о статусе договора (сделки) по ее номеру.

### HTTP-запрос

`POST http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/statusdeal`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
IDDeal (n) | Номер договора займа

### Возвращаемые значения

Параметр | Описание
--------- | -----------
НомерСделки | Номер договора займа
ДатаСделки | Дата договора займа
Статус | Статус договора займа

### Список статусов

Статус | Описание
--------- | -----------
Новый | Заведена заявка, новый займ
На рассмотрении | Займ находится на рассмотрении
Одобрен | По займу приняли положительное решение
Отказ | По займу приняли отрицательное решение
Отменен | Заемщик отказался от займа
Подписан (дистанционно) | Договор подписан дистанционно
Ожидает списания с р/с | Ожидает отправки ден.средств с банковского счета организации
Выдан | Займ выдан
Внесен аванс | Внесен аванс раньше даты платежа
Оплачен | Займ полностью погашен
У коллектора | Передан коллектору
На текущем контроле у коллектора | Коллектор контролирует займ
Готовится выезд | Коллектор готовит выезд по адресам заемщика
Признан коллектором как безнадежный | Коллектор установил, что взыскать займ невозможно
Ожидает передачи на судебную стадию | Коллектор определили перспективу взыскания через суд
Передан на судебную стадию | Займ передан в юридический отдел на взыскание через суд
Отправлена претензия | По займу отправлена претензия
Оплачена пошлина | По займу оплачена пошлина
В суде | По займу отправлено исковое заявление
Получен исполнительный лист | Получили исполнительный лист
Передан судебному приставу | Исполнительный лист передан судебному приставу
Продан | Займ продан
Списан | Займ списан

## Привязка банковской карты

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/card/attachtoclient/?id=hfkd123g4453k34598d&name=4321123456788765&client=0000001233&cardholder=IvanovIvan&validity=112020&service=Mandarinpay`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"Результат": "Карта привязана к клиенту"
}
```

Данный запрос позволяет добавить банковскую карту клиенту в системе "Моя МФО" для последующей выдачи.

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/card/attachtoclient/?id=<ТокенКарты>&name=<НомерКарты>&client=<IDКлиента>&cardholder=<ДержательКарты>&validity=<СрокДействия>&service=<СервисВыдачи>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
ТокенКарты | Токен карты в реестре сервиса выдачи
НомерКарты | Номер банковской карты
IDКлиента | Индентификатор клиента
ДержательКарты | Имя на карте
СрокДействия | Срок действия банковской карты
СервисВыдачи | Платежный сервис через который производится выдача. Название должно совпадать с названием в базе "Моя МФО" с реквизитом "Платежный сервис".

### Возвращаемые значения

Параметр | Описание
--------- | -----------
Результат | Сообщение об успешной привязке
Error | Описание ошибки, если она возникает



## Получение договора в формате "pdf" (без подписи)

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/dealinpdf/1_000000001/?pd=0808223433`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"IDClient": "000005729",
	"IDDeal": "JJJ000141",
	"Code": "506712",
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет получить заполненную данными клиента форму договора в формате pdf до подписания его клиентом, для вывода в личном кабинете для ознакомления.

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/dealinpdf/<IDDeal>/?pd=<Паспорт>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
Паспорт | Серия и номер паспорта без пробелов (не обязательный)
IDDeal | Номер договора займа

### Возвращаемые значения

Параметр | Описание
--------- | -----------
IDClient | Код заемщика
IDDeal | Номер заявки (договора)
Code | Код АСП
СообщениеОбОшибке | Описание ошибки, если она возникает

## Запрос на получение кода АСП (аналога собственоручной подписи) из "Моя МФО"

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/dealsign/code/0808223433/1_000000001`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"IDClient": "000005729",
	"IDDeal": "JJJ000141",
	"Code": "506712",
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет получить код АСП (аналог собственоручной подписи) с целью его отправки клиенту в виде СМС и ввода им в личном кабинете для подписания договора.

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/dealsign/code/<Паспорт>/<IDDeal>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
Паспорт | Серия и номер паспорта без пробелов
IDDeal | Номер договора займа

### Возвращаемые значения

Параметр | Описание
--------- | -----------
IDClient | Код заемщика
IDDeal | Номер заявки (договора)
Code | Код АСП
СообщениеОбОшибке | Описание ошибки, если она возникает

## Отправка указанного клиентом кода АСП и получение подписанного договора в формате "pdf"

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/dealsign/codereview/0808223433/1_000000001/1233243454354366234`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"IDClient": "000005729",
	"IDDeal": "JJJ000141",
	"Code": "506712",
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет отправить в базу "Моя МФО" код АСП (аналог собственоручной подписи), который клиент ввел на стороне сайта и в случае, если код введен верно вернуть подписанный данной АСП договор в формате pdf.
В результате запроса статус займа меняется на "Подисан (дистанционно)".

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/dealsign/codereview/<Паспорт>/<IDDeal>/<CodeSHA256>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
Паспорт | Серия и номер паспорта без пробелов
IDDeal | Номер договора займа
CodeSHA256 | Строка: "IDClient + IDDeal + Код АСП", зашифрованная алгоритмом SHA256

### Возвращаемые значения

Параметр | Описание
--------- | -----------
IDClient | Код заемщика
IDDeal | Номер заявки (договора)
Code | Код АСП
СообщениеОбОшибке | Описание ошибки, если она возникает

# Прием платежей

## Получение сводных данных о сумме текущей задолженности по конкретному договору для вывода в личном кабинете

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/PS/deal/1_000000001/0808223433`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"НомерДоговора": "06042017.00001",
	"ОбщийДолгНаТекДату": 245592.68,
	"ОстатокОД": 79249,
	"СуммаПроценты": 166343.68,
	"ДолгПоТекПлатежу": 70515,
	"ОстатокОДПоТекПлатежу": 1781,
	"СуммаПроцентыПоТекПлатежу": 68734,
	"ДолгПросроченный": 70515,
	"КоличествоДнейПросрочки": 18,
	"ОстатокОДПросрочено": 1781,
	"СуммаПроцентыПросрочено": 68734,
	"СуммаШтрафы": 0,
	"СуммаПошлина": 0,
	"СуммаПрочиеПлатежи": 0,
	"ОстатокНаСчете": 0,
	"ТекущийГрафикПлатежей": [
	{
		"НомерСтроки": 1,
		"ДатаПлатежа": "2017-07- 06T00:00:00",
		"СуммаПлатежа": 70515,
		"СуммаОД": 1781,
		"СуммаПроцентов": 68734,
		"СуммаПрочиеПлатежи": 0,
		"ОстатокОД": 77468,

		"СуммаШтраф": 0
	},
	{
		"НомерСтроки": 2,
		"ДатаПлатежа": "2017-08- 06T00:00:00",
		"СуммаПлатежа": 270515,
		"СуммаОД": 5573,
		"СуммаПроцентов": 264942,
		"СуммаПрочиеПлатежи": 0,
		"ОстатокОД": 71895,
		"СуммаШтраф": 0
	},
	{
		"НомерСтроки": 3,
		"ДатаПлатежа": "2017-09- 06T00:00:00",
		"СуммаПлатежа": 170515,
		"СуммаОД": 17439,
		"СуммаПроцентов": 153076,
		"СуммаПрочиеПлатежи": 0,
		"ОстатокОД": 54456,
		"СуммаШтраф": 0
	},
	{
		"НомерСтроки": 4,
		"ДатаПлатежа": "2017-10- 06T00:00:00",
		"СуммаПлатежа": 170402,
		"СуммаОД": 54456,
		"СуммаПроцентов": 115946,
		"СуммаПрочиеПлатежи": 0,
		"ОстатокОД": 0,
		"СуммаШтраф": 0
	}
	],
	"Оплаты": [
	{
		"НомерПриходника": "ТСТ00000129",
		"ДатаОплаты": "2017-06- 05T00:00:00",
		"СуммаОплаты": 200000,
		"ОнлайнОплата": false,
		"ОплатаНаРС": false
	},
	{
		"НомерПриходника": "ТСТ00000141",
		"ДатаОплаты": "2017-06- 08T00:00:00",
		"СуммаОплаты": 141030,
		"ОнлайнОплата": false,
		"ОплатаНаРС": false
	}
	],
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет получить сводную информацию о текущих статьях задолженности, а так же текущий график платежей и историю внесенных оплат.

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/PS/deal/<IDDeal>/<Паспорт>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
IDDeal | Номер договора займа
Паспорт | Серия и номер паспорта без пробелов

### Возвращаемые значения

Параметр | Описание
--------- | -----------
СообщениеОбОшибке | Описание ошибки, если она возникает

## Получение данных о задолженности при оплате через сайт (для эквайринга)

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/PS/dealforps/1_000000001/?pd=0808223433`
User-Agent: АдресСервера
Content-Type: application/json
```

> Данный запрос возвращает строку в формате JSON:

```json
{
	"НомерДоговора": "17062017.03.01",
	"ИмяОтчествоФ": "Андрей Александрович К.",
	"Телефон": "8968*****10",
	"ОбщийДолгНаТекДату": 17866.74,
	"СообщениеОбОшибке": ""
}
```

Данный запрос позволяет получить информацию о сумме текущего платежа, а так же информацию для проверки заемщиком достоверности предоставленных сведений.
Если на сайте имеется возможность приема платежей, перед перенаправлением клиента на форму ввода данных банковской карты система позволяет предоставить клиенту проверочную информацию,
которая позволяет ему узнать сумму, необходимую для внесения, а так же убедиться, что данная сумма действительно относится к нему, поскольку выводится его номер телефона и ФИО.

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/PS/dealforps/<IDDeal>/?pd=<Паспорт>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
IDDeal | Номер договора займа
Паспорт | Серия и номер паспорта без пробелов (не обязательный)

### Возвращаемые значения

Параметр | Описание
--------- | -----------
СообщениеОбОшибке | Описание ошибки, если она возникает

## [Отражение в системе "Моя МФО" полученного на сайте платежа (эквайринг)] (#payment_site) 

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/Payment/Site/<IDPayServise>/?command=pay&txn_id=4431523121&txn_date=20170825120133&account=1_1000089&sum=2200
User-Agent: АдресСервера
Content-Type: application/xml
```

> Данный запрос возвращает строку в формате XML:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<response>
	<osmp_txn_id>4431523121</osmp_txn_id>
	<prv_txn>16286f65-9bc9-11e7-ae9f-000c2990aa10</prv_txn>
	<sum>2200</sum>
	<result>0</result>
</response>
```

Данный запрос позволяет произвести отражение в системе платежа, который был осуществлен клиентом на сайте.

<aside class="notice">
Данный запрос отправляет сайт после получения информации от платежного сервиса о внесенном платеже.
</aside>

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/Payment/Site/<IDPayServise>/?command=<Command>&txn_id=<osmp_txn_id>&txn_date=<DatePayment>&account=<IDDeal>&sum=<Sum>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
IDPayServise | Идентификатор платежного сервиса в системе "Моя МФО" (Настройки Моя МФО\Общие\Обмен с сайтом\Платежные сервисы)
Command | Команда для отражения в системе "Моя МФО". Может принимать два значения: check - проверка возможности, pay - внесение оплаты
osmp_txn_id | Идентификатор платежа на стороне платежного сервиса
DatePayment | Дата платежа в формате 'yyyymmddhhmmss'
IDDeal | Номер договора займа
Sum | Сумма платежа

### Возвращаемые значения

Параметр | Описание
--------- | -----------
osmp_txn_id | Идентификатор платежа на стороне платежного сервиса
prv_txn | Идентификатор платежа в системе "Моя МФО"
sum | Сумма платежа
result | Результат выполнения (0 - успешно; 1 - не успешно)
comment | Описание ошибки
СообщениеОбОшибке | Описание ошибки, если она возникает

## Отражение в системе "Моя МФО" полученного платежа через платежные системы: QIWI, Золотая корона, Элекснет, МКБ (Московский кредитный банк)

```HTTP
GET http://192.168.0.1/MeMFOWork/hs/Payment/QIWI/?command=pay&txn_id=4431523121&txn_date=20170825120133&account=1_1000089&sum=2200
User-Agent: АдресСервера
Content-Type: application/xml
```

> Данный запрос возвращает строку в формате XML:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<response>
	<osmp_txn_id>4431523121</osmp_txn_id>
	<prv_txn>16286f65-9bc9-11e7-ae9f-000c2990aa10</prv_txn>
	<sum>2200</sum>
	<result>0</result>
</response>
```

Данный запрос позволяет произвести отражение в системе платежа, который был осуществлен клиентом через платежный сервис.

<aside class="notice">
Данный запрос отправляет непосредственно платежный сервис.
</aside>

### HTTP-запрос

`GET http://<АдресСервера>/<КаталогОпубликованногоHTTPСервиса>/hs/Payment/<PayServise>/?command=<Command>&txn_id=<osmp_txn_id>&txn_date=<DatePayment>&account=<IDDeal>&sum=<Sum>`

### Параметры запроса

Параметр | Описание
--------- | -----------
АдресСервера | Адрес сервера, на котором опубликован веб-сервис
КаталогОпубликованногоHTTPСервиса | Каталог в папке wwwroot с опубликованным сервисом
PayServise | Название платежного сервиса: MKB, ZK, QIWI
Command | Команда для отражения в системе "Моя МФО". Может принимать два значения: check - проверка возможности, pay - внесение оплаты
osmp_txn_id | Идентификатор платежа на стороне платежного сервиса
DatePayment | Дата платежа в формате 'yyyymmddhhmmss'
IDDeal | Номер договора займа
Sum | Сумма платежа

### Возвращаемые значения

Параметр | Описание
--------- | -----------
osmp_txn_id | Идентификатор платежа на стороне платежного сервиса
prv_txn | Идентификатор платежа в системе "Моя МФО"
sum | Сумма платежа
result | Результат выполнения (0 - успешно; 1 - не успешно)
comment | Описание ошибки
СообщениеОбОшибке | Описание ошибки, если она возникает

